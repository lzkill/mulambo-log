<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mulambo Log</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 640 512%22><path fill=%22%2300ffa3%22 d=%22M104 96H56c-13.3 0-24 10.7-24 24v104H8c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h24v104c0 13.3 10.7 24 24 24h48c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm528 128h-24V120c0-13.3-10.7-24-24-24h-48c-13.3 0-24 10.7-24 24v272c0 13.3 10.7 24 24 24h48c13.3 0 24-10.7 24-24V288h24c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM456 32h-48c-13.3 0-24 10.7-24 24v168H256V56c0-13.3-10.7-24-24-24h-48c-13.3 0-24 10.7-24 24v400c0 13.3 10.7 24 24 24h48c13.3 0 24-10.7 24-24V288h128v168c0 13.3 10.7 24 24 24h48c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24z%22/></svg>">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container fade-in">
        <div class="card">
            <h1><i class="fas fa-check-circle"></i> STATUS ATUAL</h1>
            <p class="subtitle">Aqui está o registro da sua mulambice.</p>
            
            <img id="result-image" src="" alt="Resultado indisponível">
            
            <div class="btn-group">
                <button id="share-btn"><i class="fas fa-share-alt"></i> COMPARTILHAR</button>
                <button class="secondary" onclick="window.location.href='/'"><i class="fas fa-undo"></i> VOLTAR</button>
            </div>
        </div>
    </div>

    <script>
        const imgData = localStorage.getItem('mulambo_result');
        if (imgData) {
            document.getElementById('result-image').src = imgData;
        } else {
            // Em vez de alertar e redirecionar imediatamente, mostramos uma imagem de erro ou mensagem
            document.querySelector('.subtitle').innerText = 'Nenhuma imagem encontrada.';
            document.getElementById('result-image').style.display = 'none';
        }

        const shareBtn = document.getElementById('share-btn');
        shareBtn.addEventListener('click', async () => {
            if (navigator.share && imgData) {
                try {
                    const res = await fetch(imgData);
                    const blob = await res.blob();
                    const file = new File([blob], 'mulambo_status.png', { type: 'image/png' });

                    await navigator.share({
                        title: 'Meu Índice de Mulambo',
                        text: 'Confira meu progresso no Mulambo Log!',
                        files: [file]
                    });
                } catch (err) {
                    console.error('Error sharing:', err);
                    alert('Erro ao compartilhar: ' + err.message);
                }
            } else {
                alert('Compartilhamento não suportado neste dispositivo ou imagem inválida.');
            }
        });
    </script>
</body>
</html>
