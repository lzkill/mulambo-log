<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado Mulambo</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container fade-in">
        <div class="card">
            <h1><i class="fas fa-check-circle"></i> STATUS ATUAL</h1>
            <p class="subtitle">Aqui está o registro do seu progresso.</p>
            
            <img id="result-image" src="" alt="Resultado indisponível">
            
            <div class="btn-group">
                <button id="share-btn"><i class="fas fa-share-alt"></i> COMPARTILHAR</button>
                <button class="secondary" onclick="window.location.href='/'"><i class="fas fa-undo"></i> VOLTAR</button>
            </div>
        </div>
    </div>

    <script>
        const imgData = localStorage.getItem('mulambo_result');
        if (imgData) {
            document.getElementById('result-image').src = imgData;
        } else {
            // Em vez de alertar e redirecionar imediatamente, mostramos uma imagem de erro ou mensagem
            document.querySelector('.subtitle').innerText = 'Nenhuma imagem encontrada.';
            document.getElementById('result-image').style.display = 'none';
        }

        const shareBtn = document.getElementById('share-btn');
        shareBtn.addEventListener('click', async () => {
            if (navigator.share && imgData) {
                try {
                    const res = await fetch(imgData);
                    const blob = await res.blob();
                    const file = new File([blob], 'mulambo_status.png', { type: 'image/png' });

                    await navigator.share({
                        title: 'Meu Índice de Mulambo',
                        text: 'Confira meu progresso no Mulambo Log!',
                        files: [file]
                    });
                } catch (err) {
                    console.error('Error sharing:', err);
                    alert('Erro ao compartilhar: ' + err.message);
                }
            } else {
                alert('Compartilhamento não suportado neste dispositivo ou imagem inválida.');
            }
        });
    </script>
</body>
</html>
